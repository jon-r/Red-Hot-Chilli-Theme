/*! Jon Richards 2015 | GPL-2.0+ | http://www.gnu.org/licenses/gpl-2.0.txt
 * INCLUDES
 * Jquery Menu Aim | https://github.com/kamens/jQuery-menu-aim
 * Get Viewport Dimensions | http://andylangton.co.uk/blog/development/get-viewport-size-width-and-height-javascript
!*/
function updateViewportDimensions(){var e=window,t=document,i=t.documentElement,n=t.getElementsByTagName("body")[0],r=e.innerWidth||i.clientWidth||n.clientWidth,l=e.innerHeight||i.clientHeight||n.clientHeight;return{width:r,height:l}}function throttle(e,t,i){t||(t=250);var n,r;return function(){var l=i||this,a=+new Date,o=arguments;n&&n+t>a?(clearTimeout(r),r=setTimeout(function(){n=a,e.apply(l,o)},t)):(n=a,e.apply(l,o))}}function setFixed(e){e.forEach(function(e){if(0==e.data("fixed")){var t=e.height(),i=e.width();e.addClass("is-fixed").data("fixed",1).after(divFiller).next(".js-filler").height(t).width(i)}}),isIndex&&(closeMainMenu(),moveMenu("in"))}function unsetFixed(e){e.forEach(function(e){1==e.data("fixed")&&e.removeClass("is-fixed").data("fixed",0).next(".js-filler").remove()}),isIndex&&moveMenu("out")}function moveMenu(e){var t=document.getElementById("primary-menu"),i=document.getElementById("js-sticky-left"),n=updateViewportDimensions();"in"==e?i.appendChild(t):"out"==e&&n.width>=481&&i.parentElement.insertBefore(t,i.nextElementSibling)}function findTop(e){var t=0;if(e.offsetParent)do t+=e.offsetTop;while(e=e.offsetParent);return t}function showSubMenu(e){bigScreen&&($row=$(e),$row.addClass("active-li"))}function hideSubMenu(e){$row=$(e),$row.removeClass("active-li")}function hideAllMenus(){bigScreen=!1,$navMain_li=$navMain_ul.find("li").removeClass("active-li")}function closeMainMenu(){$menuToggle.attr("checked",!1)}function searchToText(e){var t=$.parseJSON(e);$searchOut.html(""),$(t).each(function(e){if(4>e){var t=fileSrc.site+"products/"+this.filter+"/"+this.url+"/",i="brand"==this.filter?"<span> - Brand</span>":"<span> - Category</span>",n='<li><a href="'+t+'" >'+this.name+i+"</a></li>";$searchOut.append(n)}})}function searchTraverse(e,t){$results=$searchOut.find("li > a"),$resultCount=$results.length,"down"==e&&t<$resultCount-1?(t++,$target=$results.eq(t),$text=$target.text(),$searchIn.val($text)):"up"==e&&(t>0?(t--,$target=$results.eq(t),$text=$target.text(),$searchIn.val($text)):$target=$searchIn),$target.focus()}function setMainImg(e){$thumbImg=$imgGalleryThumb.eq(e).find("img"),$getThumbSrc=$thumbImg.attr("src").replace("gallery-thumb","gallery"),$imgGalleryMain.addClass("loading"),1==$thumbImg.data("tile")?($tileSrc=$getThumbSrc.replace("gallery","gallery-tile"),$imgGalleryMain.removeClass("loading").find("img").attr("src",$tileSrc)):($.get(fileSrc.admin,{src:$getThumbSrc,size:"tile",action:"jr_resize"},replaceMainImg),$thumbImg.data("tile",1))}function replaceMainImg(e){var t=$.parseJSON(e);$newSrc=t,$imgGalleryMain.removeClass("loading").find("img").attr("src",$newSrc)}function modalOpen(e){e.addClass("is-active")}function modalOpenSmall(e){e.addClass("is-active-small")}function modalClose(e){e.removeClass("is-active"),e.removeClass("is-active-small")}function formValidate(e){var t=e.val(),i=e.attr("name"),n=e.attr("type"),r=t.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/),l="";$formInputsReq.index(e);e.removeClass("error").removeClass("success").next("span").empty(),"email"!=n||r||(l="Please enter a valid email address",e.addClass("error")),t.length<1&&(l="Your "+i+" is required"),l.length>0?(e.addClass("error").next("span").text(l),formErrorList.push(l)):e.addClass("success")}function formAjaxReply(e){return function(t){var i=$.parseJSON(t);i.success?(e.parents(".modal-frame").addClass("modal-finished"),output=document.createElement("span"),output.textContent=i.output,output.className="form-output success",e.empty().append(output)):e.find(".response").removeClass("loading").addClass("error").html(i.output)}}var app=angular.module("redHotChilli",[]);if(app.controller("carouselCtrl",["$interval","$scope","throttled",function(e,t,n){function r(){return n(function(){for(i=0;i<l;i++)t["sl"+i]="is-active"===t["sl"+i]?"go-away":"";t["sl"+a]="is-active"},1e3)}var l=document.getElementById("js-carousel-main").children.length,a=0;return t.sl0="is-active",t.go=function(e){a=e,r()},e(function(){t.slidePause||(a=l-1>a?a+1:0,r())},8e3)}]),app.controller("masterCtrl",["$scope","$window","stickify",function(e,t,i){e.scroller={},t.onscroll=function(){i(e)}}]),app.controller("searchCtrl",["$scope","search","vp",function(e,t,i){e.searchValue="",e.results={},e.$watch("searchValue",function(i){i.length>2?t(i).then(function(t){e.results=t.data},function(e){console.log(e)}):e.results={}})}]),app.controller("menuCtrl",["$scope",function(e){}]),app.service("throttled",function(e){var t=!1;return function(i,n){n="undefined"!=typeof n?n:300,t||(i.call(),t=!0,e(function(){t=!1},n))}}),app.service("stickify",function(e){var t=document.getElementById("scrollLock"),i=function(i){return e(function(){i.scroller.fix=t.getBoundingClientRect().top<40},50)};return i}),app.service("search",function(e){return function(t){return e({method:"GET",url:fileSrc.admin,params:{keyword:t,action:"jr_autocomplete"}})}}),app.service("vp",function(e){var t=e;return{h:t.innerHeight,w:t.innerWidth}}),window.jQuery){!function(e){function t(t){var i=e(this),n=null,r=[],l=null,a=null,o=e.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:e.noop,exit:e.noop,activate:e.noop,deactivate:e.noop,exitMenu:e.noop},t),s=3,c=300,u=function(e){r.push({x:e.pageX,y:e.pageY}),r.length>s&&r.shift()},m=function(){a&&clearTimeout(a),o.exitMenu(this)&&(n&&o.deactivate(n),n=null)},d=function(){a&&clearTimeout(a),o.enter(this),h(this)},$=function(){o.exit(this)},f=function(){g(this)},g=function(e){e!=n&&(n&&o.deactivate(n),o.activate(e),n=e)},h=function(e){var t=p();t?a=setTimeout(function(){h(e)},t):g(e)},p=function(){function t(e,t){return(t.y-e.y)/(t.x-e.x)}if(!n||!e(n).is(o.submenuSelector))return 0;var a=i.offset(),s={x:a.left,y:a.top-o.tolerance},u={x:a.left+i.outerWidth(),y:s.y},m={x:a.left,y:a.top+i.outerHeight()+o.tolerance},d={x:a.left+i.outerWidth(),y:m.y},$=r[r.length-1],f=r[0];if(!$)return 0;if(f||(f=$),f.x<a.left||f.x>d.x||f.y<a.top||f.y>d.y)return 0;if(l&&$.x==l.x&&$.y==l.y)return 0;var g=u,h=d;"left"==o.submenuDirection?(g=m,h=s):"below"==o.submenuDirection?(g=d,h=m):"above"==o.submenuDirection&&(g=s,h=u);var p=t($,g),v=t($,h),y=t(f,g),b=t(f,h);return y>p&&v>b?(l=$,c):(l=null,0)};i.mouseleave(m).find(o.rowSelector).mouseenter(d).mouseleave($).click(f),e(document).mousemove(u)}e.fn.menuAim=function(e){return this.each(function(){t.call(this,e)}),this}}(jQuery);var stickyRight=document.getElementById("js-sticky-right"),stickyLeft=document.getElementById("js-sticky-left"),$stRight=$(stickyRight),$stLeft=$(stickyLeft),$fixedHeader=[$stRight,$stLeft],titlePos=findTop(stickyLeft),divFiller='<div class="js-filler"></div>';window.onscroll=throttle(function(){scrollPos=window.scrollY,scrollPos>titlePos+40?setFixed($fixedHeader):unsetFixed($fixedHeader)},100),isIndex&&moveMenu("out");var $menuToggle=$("#menu-toggle"),$navMain_ul=$("#js-main-list"),$navMain_li=$navMain_ul.find("li"),bigScreen=!1;$navMain_ul.mouseenter(function(){vp=updateViewportDimensions(),vp.width>=1030?(bigScreen=!0,$navMain_ul.menuAim({activate:showSubMenu,deactivate:hideSubMenu,exitMenu:hideAllMenus})):bigScreen=!1}),$navMain_li.click(function(){$(this).toggleClass("active-li")}),$navMain_ul.mouseleave(function(){window.setTimeout(closeMainMenu,300)});var MIN_LENGTH=3,$searchForm=$("#js-form-complete").find(".form-search"),$searchIn=$searchForm.find(".search-in"),$searchOut=$searchForm.find(".search-out");$searchIn.keyup(function(){if(vp=updateViewportDimensions(),vp.width>=1030){var e=$(this).val();e.length>=MIN_LENGTH?$.get(fileSrc.admin,{keyword:e,action:"jr_autocomplete"}).done(searchToText):$searchOut.html("")}}),$searchIn.on("keydown",function(e){$results=$searchOut.find("li > a"),"40"==e.keyCode&&$results.length>0&&(e.preventDefault(),searchTraverse("down",-1))}),$searchOut.on("keydown","li > a",function(e){$focussed=$searchOut.find(":focus"),"40"==e.keyCode&&$focussed.length>0?(e.preventDefault(),$i=$(this).parent("li").index(),searchTraverse("down",$i)):"38"==e.keyCode&&$focussed.length>0&&(e.preventDefault(),$i=$(this).parent("li").index(),searchTraverse("up",$i))});var $imgGalleryMain=$("#js-gallery-primary"),$imgGalleryFull=$("#js-gallery-thumbs"),$imgGalleryThumb=$imgGalleryFull.find("li");$imgGalleryPrev=$("#js-gallery-prev"),$imgGalleryNext=$("#js-gallery-next"),$imgGalleryNum=$imgGalleryThumb.length-1,$imgGalleryThumb.click(function(){i=$(this).index(),setMainImg(i)}),$imgGalleryPrev.click(function(){0==$imgGalleryNum&&($imgGalleryNum=$imgGalleryThumb.length),$imgGalleryNum--,setMainImg($imgGalleryNum)}),$imgGalleryNext.click(function(){$imgGalleryNum==$imgGalleryThumb.length-1&&($imgGalleryNum=-1),$imgGalleryNum++,setMainImg($imgGalleryNum)});var $imgGalleryModal=$("#js-gallery-modal"),$imgGalleryOpen=$("#js-gallery-zoom"),$imgGalleryClose=$imgGalleryModal.find(".modal-close");$buyModal=$("#js-buy-modal"),$buyModalOpen=$("#js-buy-btn"),$buyModalClose=$buyModal.find(".modal-close"),$queryModal=$("#js-query-modal"),$queryModalOpen=$("#js-query-btn"),$queryModalClose=$queryModal.find(".modal-close"),$imgGalleryOpen.click(function(){$getImgSrc=$imgGalleryMain.find("img").attr("src"),$bigImgSrc=$getImgSrc.replace("gallery-tile","gallery"),$imgGalleryModal.find("img").length?$imgGalleryModal.find("img").attr("src",$bigImgSrc):($bigImgNew='<img src="'+$bigImgSrc+'" >',$imgGalleryModal.append($bigImgNew)),modalOpen($imgGalleryModal)}),$imgGalleryClose.click(function(){modalClose($imgGalleryModal)}),$buyModalOpen.click(function(){modalOpenSmall($buyModal)}),$queryModalOpen.click(function(){modalOpenSmall($queryModal)}),$buyModalClose.click(function(){modalClose($buyModal)}),$queryModalClose.click(function(){modalClose($queryModal)});var $form=$(".js_contact_form"),$formInputsReq=$form.find(".req"),$formInputsOptional=$form.find(":not(.req)"),$formNextBtn=$form.find(".js_nextBtn"),$formBackBtn=$form.find(".js_backBtn"),$formBlips=$form.next(".form-progress").find(".progress-blip"),formErrorList=[];$form.attr("novalidate",""),$form.submit(function(e){formErrorList=[],$thisForm=$(this),$response=$thisForm.find(".response"),e.preventDefault(),$thisForm.find($formInputsReq).each(function(){$el=$(this),formValidate($el)}),$response.removeClass("success").removeClass("error").empty(),0==formErrorList.length?($response.addClass("loading"),$.get(fileSrc.admin,{keyword:$thisForm.serialize(),action:"jr_formsubmit",url:window.location.href}).done(formAjaxReply($thisForm))):$response.addClass("error").html("Please fill in required items")}),$formNextBtn.click(function(e){$thisSubForm=$(this).closest("fieldset.subform-active"),$subFormIndex=$thisSubForm.index(),formErrorList=[],$response=$thisSubForm.find(".response"),$thisSubForm.find($formInputsReq).each(function(){$el=$(this),formValidate($el)}),$response.removeClass("success").removeClass("error").empty(),0==formErrorList.length?($thisSubForm.removeClass("subform-active").next("fieldset").addClass("subform-active"),$formBlips.eq($subFormIndex).addClass("active")):$response.addClass("error").html("Please fill in required items")}),$formBackBtn.click(function(e){$thisSubForm=$(this).closest("fieldset.subform-active"),$thisSubForm.removeClass("subform-active").prev("fieldset").addClass("subform-active"),$subFormIndex=$thisSubForm.index(),$formBlips.eq($subFormIndex-1).removeClass("active")}),$formInputsReq.change(function(e){$el=$(this),formValidate($el)}),$formInputsOptional.change(function(e){$el=$(this),$el.val().length>0?$el.addClass("success"):$el.removeClass("success")}),$itemTabFrame=$("#js-tabs-frame"),$itemTabToggle=$itemTabFrame.find(".tab-toggle"),$itemTabToggle.click(function(){$(this).closest("section").toggleClass("active").siblings("section").removeClass("active")}),$itemSpecsBox=$("#js-specs-list"),$itemSpecsBtn=$("#js-specs-copy"),$itemSpecsBtn.click(function(){fix=$itemSpecsBox.html().replace(/(<li>)|(\s\s+)|(<img.*alt=")|("><a.*<\/a>)/g,"").replace(/<\/li>/g,"<br>"),el=document.createElement("p"),el.className="item-dimensions tile-inner",el.innerHTML=fix,$itemSpecsBox.after(el),$itemSpecsBox.remove(),$itemSpecsBtn.remove()})}
